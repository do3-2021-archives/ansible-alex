---
- hosts: debian-0
  vars_files:
    - vars/main.yml
  roles:
  - { role: geerlingguy.firewall }
  tasks:
    - name: Installer Apache
      ansible.builtin.apt:
        name: "{{item}}"
        state: present
        update_cache: true
      loop:
        - apache2
        - libapache2-mod-php7.4

    - name: Démarrer le service Apache
      ansible.builtin.service:
        name: apache2
        state: started
        enabled: true

    - name: copier un phpinfo
      ansible.builtin.copy:
        src: info.php
        dest: /var/www/html/index.php
        owner: www-data
        group: www-data
        mode: 0664

    - name: reload
      ansible.builtin.service:
        name: apache2
        state: restarted
        enabled: true
      tags: 
      - never
      - relance
    
    - name: change config
      ansible.builtin.copy:
        src: ports.j2
        dest: /etc/apache2/ports.conf
        owner: www-data
        group: www-data
        mode: 0664


- hosts: rocky-0
  tasks:
    - name: Installer Apache
      ansible.builtin.apt:
        name: "{{item}}"
        state: present
        update_cache: true
      loop:
        - httpd
        - php

    - name: Démarer le service
      ansible.builtin.service:
        name: httpd
        state: started
        enabled: true

    - name: copier le phpinfo
      ansible.builtin.copy:
        src: info.php
        dest: /var/www/html/index.php
        owner: apache
        group: apache
        mode: 0664

    - name: reload
      ansible.builtin.service:
        name: apache2
        state: restarted
        enabled: true
      tags: 
      - never
      - relance